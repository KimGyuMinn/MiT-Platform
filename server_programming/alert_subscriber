import threading, time

from kafka import KafkaAdminClient, KafkaConsumer, KafkaProducer
from kafka.admin import NewTopic

class Consumer(threading.Thread):
    def __init__(self):
        threading.Thread.__init__(self)
        self.stop_event = threading.Event()

    def stop(self):
        self.stop_event.set()
    
    def run(self):
        consumer = KafkaConsumer(bootstrap_servers = 'localhost:9092',
                                auto_offset_reset='earliest',
                                consumer_timeout_ms=1000)
        consumer.subscribe(['alarm'])
        alert = []

        while not self.stop_event.is_set():
            for message in consumer:
                user = message[0]
                value = message[1]
                timestamp = message[2]
                count = alert[user] + 1
                if user not in alert:
                    alert.append({user:count, 'timestamp':timestamp})
                else:
                    if time.now() - alert[user]['timestamp'] < 
                    alert.append({'user':count})
                

                print(message)

                if self.stop_event.is_set():
                    break

        consumer.close()

Consumer().run(self)
